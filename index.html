<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>دولابي | عرض منتجات</title>
<style>
body { font-family: Arial, Tahoma; margin:0; background:#fff200; overflow-x:hidden;}
header { color:#000; padding:30px; text-align:center; font-size:50px; font-weight:bold; text-shadow:1px 1px 2px #555; animation:slideIn 1s ease-out;}
@keyframes slideIn {0% {transform: translateY(-50px); opacity:0;} 100% {transform: translateY(0); opacity:1;}}
.contact {text-align:center; background:#fff8b0; padding:10px; font-size:14px; color:#111; animation:fadeIn 1s ease-in;}
@keyframes fadeIn {0% {opacity:0;} 100% {opacity:1;}}
.container {padding:20px; position:relative;}
.products {display:grid; grid-template-columns:repeat(auto-fill,minmax(200px,1fr)); gap:20px;}
.card {background:#fff; border-radius:10px; overflow:hidden; box-shadow:0 4px 10px rgba(0,0,0,.1); transform:translateX(-100vw); animation:slideInCard 0.8s forwards;}
@keyframes slideInCard {0% {transform: translateX(-100vw) rotate(-10deg); opacity:0;} 100% {transform: translateX(0) rotate(0deg); opacity:1;}}
.card img {width:100%; height:250px; object-fit:cover;}
.price {padding:10px; font-size:18px; font-weight:bold; text-align:center; color:#111;}
.admin-btn {text-align:center; margin-top:30px; font-size:12px;}
.admin-btn button {color:#111; font-weight:bold; padding:10px 20px; font-size:14px; cursor:pointer;}
.admin {max-width:400px; margin:40px auto; background:#ffe4b5; padding:20px; border-radius:10px; display:none;}
input, button {width:100%; padding:10px; margin:10px 0; border-radius:5px; border:1px solid #ccc;}
button {background:#000; color:#fff; border:none; cursor:pointer; transition:.3s;}
button:hover {background:#333;}
.delete-btn {width:100%; padding:5px; background:#ff4500; color:#fff; border:none; cursor:pointer; margin-top:5px; border-radius:5px; display:none;}
.delete-btn:hover {background:#ff0000;}
.confetti {position:fixed; width:10px; height:10px; background:#ff0; top:0; animation:fall 3s linear infinite; opacity:0.7; z-index:9999;}
@keyframes fall {0% {transform:translateY(0) rotate(0deg);} 100% {transform:translateY(100vh) rotate(360deg);}}
</style>
</head>
<body>
<header>دولابي</header>
<div class="contact">
<p>العنوان: ديرب نجم بجوار كافيه المشربيه ومطعم عيسي</p>
<p>رقم الاستفسارات: 01116535376</p>
</div>

<div class="container">
  <div class="products" id="products"></div>
  <div class="admin-btn">
    <button id="adminBtn">دخول الإدارة</button>
  </div>
</div>

<div class="admin" id="admin">
<h3>لوحة التحكم</h3>
<input type="password" id="code" placeholder="الكود السري">
<button id="loginBtn">دخول</button>
<div id="panel" style="display:none">
  <input type="file" id="img">
  <input type="text" id="price" placeholder="السعر">
  <button id="addProductBtn">إضافة منتج</button>
</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getDatabase, ref, push, onValue, remove } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-database.js";
import { getStorage, ref as sRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-storage.js";

const firebaseConfig = {
  apiKey: "AIzaSyChb7U4jURTdSv_Nb9D7jgwRzcRYhKb91w",
  authDomain: "ddoollaabbii.firebaseapp.com",
  projectId: "ddoollaabbii",
  storageBucket: "ddoollaabbii.firebasestorage.app",
  messagingSenderId: "635784319526",
  appId: "1:635784319526:web:8b95e477345d819ebe4ce7"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const storage = getStorage(app);

const SECRET = "A1234S";

// فتح الادارة
document.getElementById('adminBtn').addEventListener('click', () => {
  document.getElementById("admin").style.display = "block";
});

// تسجيل الدخول
document.getElementById('loginBtn').addEventListener('click', () => {
  if(document.getElementById('code').value === SECRET){
    document.getElementById('panel').style.display = 'block';
    showDeleteButtons();
  } else alert("الكود غلط");
});

function showDeleteButtons() {
  if(document.getElementById("code").value === SECRET)
    document.querySelectorAll('.delete-btn').forEach(btn => btn.style.display = 'block');
}

// إضافة منتج
document.getElementById('addProductBtn').addEventListener('click', async () => {
  const fileInput = document.getElementById('img');
  const file = fileInput.files[0];
  const price = document.getElementById('price').value;
  
  if (!file) return alert("اختر صورة");
  if (!price) return alert("اكتب السعر");

  try {
    const storageReference = sRef(storage, 'products/' + file.name);
    await uploadBytes(storageReference, file);
    const url = await getDownloadURL(storageReference);
    await push(ref(db,'products'), { img: url, price });
    fileInput.value = "";
    document.getElementById('price').value = "";
  } catch(err) {
    console.error(err);
    alert("حصل خطأ أثناء رفع المنتج");
  }
});

// حذف منتج
function deleteProduct(key){
  if(confirm("متأكد عايز تمسح المنتج؟")){
    remove(ref(db,'products/'+key));
  }
}

// عرض المنتجات
function render(){
  const box = document.getElementById("products");
  box.innerHTML = "";
  const productsRef = ref(db,'products');
  onValue(productsRef, snapshot => {
    box.innerHTML = "";
    snapshot.forEach(childSnap=>{
      const p = childSnap.val();
      const key = childSnap.key;
      box.innerHTML += `
        <div class="card">
          <img src="${p.img}">
          <div class="price">${p.price} جنيه</div>
          <button class="delete-btn" onclick="deleteProduct('${key}')">حذف</button>
        </div>`;
    });
    showDeleteButtons();
  });
}

// Confetti
function createConfetti(){
  for(let i=0;i<50;i++){
    let confetti=document.createElement('div');
    confetti.className='confetti';
    confetti.style.left=Math.random()*100+'vw';
    confetti.style.background=`hsl(${Math.random()*360},100%,50%)`;
    confetti.style.animationDuration=(2+Math.random()*3)+'s';
    document.body.appendChild(confetti);
    setTimeout(()=>confetti.remove(),5000);
  }
}

window.onload = ()=>{
  render();
  createConfetti();
}
</script>
</body>
</html>
